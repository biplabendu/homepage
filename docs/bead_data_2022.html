<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Biplabendu Das" />


<title>Deborah_bead_data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Biplabendu Das</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="research.html">
    <span class="fa fa-flask"></span>
     
    Research
  </a>
</li>
<li>
  <a href="camponotus_floridanus.html">
    <span class="fa fa-bug"></span>
     
    Camponotus_floridanus
  </a>
</li>
<li>
  <a href="https://www.academia.edu/attachments/81365810/download_file">
    <span class="fa fa-address-card"></span>
     
    CV
  </a>
</li>
<li>
  <a href="ecology.html">
    <span class="fa fa-leaf"></span>
     
    EcologyLab
  </a>
</li>
<li>
  <a href="IUSSI2022.html">
    <span class="fa fa-pie-chart"></span>
     
    IUSSI_Demography
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/another_ant_guy">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/biplabendu/">
    <span class="fa fa-linkedin"></span>
     
  </a>
</li>
<li>
  <a href="https://www.facebook.com/biplabendu">
    <span class="fa fa-facebook"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Deborah_bead_data</h1>
<h4 class="author">Biplabendu Das</h4>
<h4 class="date">14 September, 2022</h4>

</div>


<pre class="r"><code>## Set color scheme for age classes
age_colors &lt;- c(&quot;#8D72A1&quot;, &quot;#F26C7F&quot;, &quot;#FBAD73&quot;, &quot;#9CD5A2&quot;, &quot;#F29544&quot;)</code></pre>
<div id="overviewgoals" class="section level2">
<h2>Overview/Goals</h2>
<p>Email from Deborah:</p>
<p>This data set comes from an experiment with harvester ants last summer. Harvester ant foragers bring in lots of seeds and parts of plants, some of which are rejected by ants inside the nest. Eventually, the refuse is carried out and put on the nest mound midden.</p>
<blockquote>
<p>Here we presented small plastic beads coated in oil which the ants brought into the nest, and were later put back out on the midden, outside the colony, close to the nest entrance.</p>
</blockquote>
</div>
<div id="bead-data-2021" class="section level2">
<h2>Bead data 2021</h2>
<div id="load-data" class="section level3">
<h3>Load data</h3>
<pre class="r"><code># read foraging_data.csv
for.dat &lt;- read.csv(paste0(path_to_repo,&quot;/data/foraging_data.csv&quot;),
                    stringsAsFactors = F, header = T) %&gt;% as_tibble()

# read bead data
bead.dat &lt;- read.csv(paste0(path_to_repo, &quot;/data/beads_out_new.csv&quot;),
                stringsAsFactors = F, header = T) %&gt;% as_tibble()

# read colony-age data
colony.dat &lt;- read.csv(paste0(path_to_repo, &quot;/data/foraging_counts_08_13_22.csv&quot;),
                       stringsAsFactors = F, header = T) %&gt;% as_tibble() %&gt;% 
  select(colonyID = colony_ID, everything()) %&gt;% 
  # mutate(colonyID = as.factor(colonyID)) %&gt;% 
  mutate(age_class = ifelse(age_2022 &lt;= 2, &quot;1-2_yr_old&quot;,
                                  ifelse(age_2022 &gt; 2 &amp; age_2022 &lt;= 4, &quot;3-4_yr_old&quot;,
                                         &quot;older_than_5_yr&quot;)))</code></pre>
</div>
<div id="summarize-the-data" class="section level3">
<h3>Summarize the data</h3>
<pre class="r"><code>writeLines(&quot;What are the names of the colonies? \nShown as: Colony-ID&quot;)</code></pre>
<pre><code>## What are the names of the colonies? 
## Shown as: Colony-ID</code></pre>
<pre class="r"><code>bead.dat %&gt;% 
  select(colonyID) %&gt;% 
  distinct() %&gt;% 
  left_join(colony.dat, by=&quot;colonyID&quot;) %&gt;%
  head() %&gt;% 
  arrange(age_2022)</code></pre>
<pre><code>## # A tibble: 6 x 8
##   colonyID  quad age_2022  east north colony_type  counted_08_13_22 age_class   
##      &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;       
## 1     1474     6        3   597   472 Young        &quot;c&quot;              3-4_yr_old  
## 2     1393     3        7   381   589 Active Adult &quot;C&quot;              older_than_…
## 3     1338     4        8   360   543 Active Adult &quot;c&quot;              older_than_…
## 4     1368     4        8   426   466 Active Adult &quot;&quot;               older_than_…
## 5     1131     5       21   563   636 Active Adult &quot;C&quot;              older_than_…
## 6      922     5       22   463   589 Active Adult &quot;&quot;               older_than_…</code></pre>
<pre class="r"><code># Specify the dates for green/pink beads
green.days &lt;- c(&quot;8/23/21&quot;,&quot;8/24/21&quot;, &quot;8/27/21&quot;,&quot;8/28/21&quot;) %&gt;% as.Date(format = &quot;%m/%d/%y&quot;)
pink.days &lt;- c(&quot;8/25/21&quot;,&quot;8/26/21&quot;) %&gt;% as.Date(format = &quot;%m/%d/%y&quot;)</code></pre>
</div>
<div id="clean-data" class="section level3">
<h3>Clean Data</h3>
<pre class="r"><code>df &lt;-
  bead.dat %&gt;%
  
  # retain only useful data
  na.omit() %&gt;% 
  
  # arrange by colony IDs
  arrange(colonyID) %&gt;% 
  
  mutate(date = as.Date(date, format = &quot;%m/%d/%y&quot;)) %&gt;%
  mutate(colonyID = factor(colonyID)) %&gt;% 
  
  # add a column that specifies the color of beads used
  mutate(bead_col = ifelse(date %in% green.days[1:2], &quot;green&quot;,
                           ifelse(date %in% green.days[3:4], &quot;green-2&quot;,
                           ifelse(date %in% pink.days, &quot;pink&quot;, NA)))) %&gt;%
  
  mutate(batch = ifelse(date %in% c(green.days[c(1,3)],pink.days[1]), &quot;batch_A&quot;,
                        ifelse(date %in% c(green.days[c(2,4)],pink.days[2]), &quot;batch_B&quot;,NA))) %&gt;% 
  
  
  # # SIDE NOTE: Explore the original dataset
  # mutate_at(vars(colnames(.)[names(.) %in% c(paste0(&quot;n_returned_Day&quot;,1:6))]),
  #       .funs = funs(ifelse(.==&quot;&quot;, NA, as.character(.)))) %&gt;% 
  # mutate_at(vars(colnames(.)[names(.) %in% c(paste0(&quot;n_returned_Day&quot;,1:6))]),
  #       .funs = as.numeric) %&gt;% head()
  
  
  # CLEAN: Keep only data for first three days of observations after presenting beads
  select(num_out:n_returned_Day3, bead_col, batch) %&gt;%
  
  # format columns appropriately
  mutate(n_collected = as.numeric(readr::parse_number(n_collected))) %&gt;% 
  mutate(n_returned_Day1 = as.numeric(n_returned_Day1)) %&gt;% 
  mutate(n_returned_Day2 = as.numeric(n_returned_Day2)) %&gt;% 
  mutate(n_returned_Day3 = as.numeric(n_returned_Day3))
  

# query 1  
# df %&gt;% 
#   # summarize the data by batch and bead_col
#   group_by(batch, bead_col, date) %&gt;%
#   summarize(n_colonies = n())
  
# query 2  
# It seems the data for 25-Aug-2021, Colony-1474 is missing (or too little);  
df &lt;- 
  df %&gt;% 
  # remove it
  filter(!is.na(n_collected))</code></pre>
<p>CLEAN UP:</p>
<ol style="list-style-type: decimal">
<li><p>There are four colonies (1 green, 3 pink) that collect &lt;30 of the 50 beads presented. [n_collected = 8, 9, 17, 20]. It might be a good idea to leave them out before we analyze the dat, at least for Colonies that collected ≤10 beads of the 50 presented. [cleanup 1]</p></li>
<li><p>Data for Colony 1288 (green-1; 24 to 26 Aug) shows that 48 beads were presented but 50 beads were collected at the refuse pile. Removing that from our dataset as I am unsure of the source of the error. [cleanup 2]</p></li>
</ol>
<pre class="r"><code>dat &lt;-
  df %&gt;%
  # remove the time column (not necessary; almost the same time) 
  select(-4) %&gt;% 
  filter(!(bead_col==&quot;pink&quot; &amp; colonyID %in% c(&quot;969&quot;,&quot;1338&quot;))) %&gt;% # cleanup 1
  filter(!(bead_col==&quot;green&quot; &amp; colonyID == &quot;1288&quot;)) # cleanup 

writeLines(&quot;Which colony-days remain after cleanup?&quot;)</code></pre>
<pre><code>## Which colony-days remain after cleanup?</code></pre>
<pre class="r"><code>dat %&gt;% 
  select(date, colonyID) %&gt;% 
  distinct() %&gt;% 
  mutate(colonyID = as.numeric(as.character(colonyID))) %&gt;%
  left_join(colony.dat, by=&quot;colonyID&quot;) %&gt;% 
  group_by(colonyID, age_2022, age_class) %&gt;% 
  summarize(n_days = n()) %&gt;% 
  arrange(age_2022)</code></pre>
<pre><code>## # A tibble: 13 x 4
## # Groups:   colonyID, age_2022 [13]
##    colonyID age_2022 age_class       n_days
##       &lt;dbl&gt;    &lt;int&gt; &lt;chr&gt;            &lt;int&gt;
##  1     1474        3 3-4_yr_old           1
##  2     1524        3 3-4_yr_old           1
##  3     1423        5 older_than_5_yr      1
##  4     1393        7 older_than_5_yr      3
##  5     1338        8 older_than_5_yr      2
##  6     1368        8 older_than_5_yr      3
##  7     1288       11 older_than_5_yr      1
##  8     1233       12 older_than_5_yr      2
##  9     1131       21 older_than_5_yr      3
## 10      922       22 older_than_5_yr      3
## 11      961       22 older_than_5_yr      2
## 12      969       22 older_than_5_yr      1
## 13      810       25 older_than_5_yr      2</code></pre>
<pre class="r"><code>## Part 5: Plot cum. prop.

tidydat.2021 &lt;-
  dat %&gt;% 
  
  na.omit() %&gt;%
  
  ## only keep the colonies that collected more than 40 beads
  filter(n_collected &gt;= 40) %&gt;% 
  
  # Cumulative prop 
  # create the cumulative sums
  mutate(cum_prop_day1 = n_returned_Day1/n_collected,
         cum_prop_day2 = (n_returned_Day1+n_returned_Day2)/n_collected,
         cum_prop_day3 = (n_returned_Day1+n_returned_Day2+n_returned_Day3)/n_collected) %&gt;% 
  
  select(num_out, date, colonyID, n_collected, bead_col, batch:cum_prop_day3) %&gt;% 
  
  pivot_longer(cols = starts_with(&quot;cum_prop&quot;),
               names_to = &quot;day_of_obs&quot;,
               values_to = &quot;cum_prop_returned&quot;) %&gt;% 
  
  mutate(day_of_obs = as.numeric(readr::parse_number(day_of_obs))) %&gt;% 
  mutate(date = date+day_of_obs-1)
  
# # sumarrize the tidydat
# tidydat.2021 %&gt;% 
#   group_by(batch, bead_col, date) %&gt;%
#   summarize(n_colonies = n())
# 
# # what proportion of collected beads do they put out by day 3?
# tidydat.2021 %&gt;% 
#   filter(day_of_obs==&quot;3&quot;) %&gt;%
# # 
# #   pull(n_collected) %&gt;% sd()/sqrt(51)
# #   sd()/sqrt(17) # 17 = length of cum_prop_returned
# 
#   group_by(bead_col, batch) %&gt;% 
#   summarize(n_colonies=n(),mean_prop_returned=mean(cum_prop_returned))</code></pre>
<hr />
<pre class="r"><code># Selecting old colonies

old.summ &lt;- 
  tidydat.2021 %&gt;% 
  mutate(colonyID = as.character(colonyID) %&gt;% as.numeric()) %&gt;% 
  left_join(colony.dat, by=&quot;colonyID&quot;) %&gt;% 
  # select(date, colonyID, bead_col, day_of_obs, cum_prop_returned, age_2022) %&gt;% 
  
  mutate(age_obs = age_2022-1) %&gt;% 
  
  mutate(age_class = ifelse(age_obs &lt;= 2, &quot;1-2_yr_old&quot;,
                            ifelse(age_obs &gt;= 5, &quot;older_than_5_yr&quot;, &quot;3-4_yr_old&quot;))) %&gt;% 
  mutate(age_class = factor(age_class, levels = c(&quot;1-2_yr_old&quot;, &quot;3-4_yr_old&quot;, &quot;older_than_5_yr&quot;))) %&gt;% 
  
  mutate(day_of_obs = paste0(&quot;D&quot;,day_of_obs,&quot;_bN&quot;)) %&gt;% 
  mutate(day_of_obs = factor(day_of_obs, levels = c(&quot;D1_bN&quot;, &quot;D2_bN&quot;, &quot;D3_bN&quot;))) %&gt;% 
  
  mutate(bead_col = factor(paste0(bead_col,&quot;-21&quot;))) %&gt;% 
  mutate(ID = paste0(colonyID,&quot;_&quot;,bead_col, &quot;_&quot;, age_obs)) %&gt;% 
  
  ## change column names to make them compatible to the 2022 dataset
  select(colonyID, date,
         bead_color = bead_col,
         age_2022, age_obs, age_class, 
         beads_collected = n_collected,
         counted_when = day_of_obs,
         cum_prop = cum_prop_returned)


old.summ %&gt;% 
  as_tibble() %&gt;% 
  filter(counted_when==&quot;D3_bN&quot;) %&gt;% 
  group_by(colonyID,age_class) %&gt;% 
  summarize(n_reps = n()) %&gt;% 
  right_join(old.summ %&gt;% select(colonyID, age_obs) %&gt;% distinct()) %&gt;% 
  arrange(age_obs)</code></pre>
<pre><code>## # A tibble: 11 x 4
## # Groups:   colonyID [11]
##    colonyID age_class       n_reps age_obs
##       &lt;dbl&gt; &lt;fct&gt;            &lt;int&gt;   &lt;dbl&gt;
##  1     1474 1-2_yr_old           1       2
##  2     1393 older_than_5_yr      1       6
##  3     1338 older_than_5_yr      1       7
##  4     1368 older_than_5_yr      1       7
##  5     1288 older_than_5_yr      1      10
##  6     1233 older_than_5_yr      1      11
##  7     1131 older_than_5_yr      2      20
##  8      922 older_than_5_yr      2      21
##  9      961 older_than_5_yr      1      21
## 10      969 older_than_5_yr      1      21
## 11      810 older_than_5_yr      2      24</code></pre>
<pre class="r"><code>old.summ %&gt;%   
   mutate(ID = paste0(colonyID,&quot;_&quot;,bead_color, &quot;_&quot;, age_obs)) %&gt;% 
  
  ggplot() + 
  geom_line(aes(x=factor(counted_when), 
                y=cum_prop, group=ID, col=ID),
            size=2,
            alpha=0.6) +
  facet_wrap(~ID, nrow = 2) +
  theme_Publication(base_size = 10) +
  # scale_color_manual(values=c(&quot;darkgreen&quot;,&quot;darkred&quot;)) +
  
  scale_y_continuous(breaks = c(0,.2,.4,.6,.8,1),
                     labels = c(&quot;0&quot;, &quot;&quot;, &quot;0.4&quot;,&quot;&quot;,&quot;0.8&quot;,&quot;&quot;),
                     limits = c(0,1)) +
  
  xlab(&quot;Day of obs&quot;) +
  ylab(&quot;Cumulutative proportion \nof beads returned&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/abc-1.png" width="672" /></p>
<pre class="r"><code>old.summ %&gt;% 
    
    ggplot(aes(x=counted_when, y=cum_prop, 
               fill=age_class, color=age_class, group=age_class)) +
    geom_jitter(size=2, alpha=0.4, width=0.2) +
    # geom_line(aes(group=colonyID), size=0.5, alpha=0.7) +
    # geom_boxplot(alpha=0.3) +
    geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), 
                level=0.95,
                alpha=0.4, size = 2,
                aes(color=age_class)) +
  # geom_smooth(method = &quot;lm&quot;, formula = y~x, alpha=0.3, aes(color=age_class, lty=age_class)) +
  
  facet_grid(~age_class) +
  # coord_flip() +
  # scale_y_continuous(n.breaks = 3,
  #                    labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
  
  theme_Publication(base_size = 15) +
  # rotate x-axis lables
  theme(axis.text.x=element_text(angle=90,hjust=1))+
  # scale_fill_discrete() +
  # scale_color_discrete()

  # scale_fill_viridis_d(option=&quot;cividis&quot;) +
  # scale_color_viridis_d(option = &quot;cividis&quot;)
  
  scale_fill_manual(values = age_colors) +
  scale_color_manual(values = age_colors) +
  
  labs(x = &quot;Day-time of observation&quot;,
       y= &quot;cumulative proportion \nof beads returned&quot;,
       subtitle = &quot;Line indicates y ~ log2(x+1) + 95% CI&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/abc-2.png" width="672" /></p>
<hr />
</div>
</div>
<div id="bead-data-2022" class="section level2">
<h2>Bead data 2022</h2>
<pre class="r"><code>filename &lt;- &quot;/Users/biplabendudas/Documents/05_postdoc/Deborah_Gordon/04_research/2022/02_bead_data/data/bead_data_2022/all_bead_data_2022/2022_bead_data_master_replicate_one_two_three_29Aug22.csv&quot;
dat.2022 &lt;- read.csv(filename,
                     header = T, stringsAsFactors = F,
                     na.strings = c(&quot;&quot;,&quot; &quot;,&quot;did_not_count&quot;,&quot;NA&quot;,
                                    &quot;did_not_check&quot;,
                                    &quot;it_rained_could_not_check&quot;)) %&gt;% 
  as_tibble() %&gt;% 
  
  # select the relevant columns
  select(date, colonyID, age_class, age_2022, 
         bead_color, beads_put_out, beads_collected,
         beads_returned_Day1_beforenoon,
         beads_returned_Day1_afternoon,
         beads_returned_Day2_morning,
         beads_returned_Day2_beforenoon,
         beads_returned_Day2_afternoon,
         beads_returned_Day3_beforenoon,
         beads_returned_Day4_morning,
         beads_returned_Day4_beforenoon) %&gt;% 
  
  # calculate the cumulative proportion of beads returned
  group_by(date, bead_color) %&gt;% 
    
  # filter out the colonies for which we still need to check the data
  filter(!(colonyID==&quot;1560&quot; &amp; bead_color==&quot;green&quot;)) %&gt;% 
  filter(!(colonyID==&quot;1288&quot; &amp; bead_color==&quot;green&quot;)) %&gt;%
  filter(!(colonyID==&quot;1546&quot; &amp; bead_color==&quot;green&quot;)) %&gt;%
  
  # convert all the bead count columns as numeric
  mutate_at(vars(matches(&quot;beads_&quot;)), as.numeric) %&gt;% 
  
  ungroup()


## Create a tidy dataset and calculate the cumulative proportion of beads returned by colonies
tidydat.2022 &lt;-
  dat.2022 %&gt;% 
  
  # replace all the NAs with 0 to be able to calculate proportions
  mutate_at(vars(matches(&quot;beads_&quot;)), function(x) ifelse(is.na(x), 0, x)) %&gt;%
  
  # day 1 - before noon
  mutate(cum_prop_returned_D1_beforenoon = round(beads_returned_Day1_beforenoon/beads_collected, 2)) %&gt;% 
  mutate(cum_prop_returned_D1_afternoon = round(cum_prop_returned_D1_beforenoon+beads_returned_Day1_afternoon/beads_collected, 2)) %&gt;% 
  mutate(cum_prop_returned_D2_morning = round(cum_prop_returned_D1_afternoon+beads_returned_Day2_morning/beads_collected, 2)) %&gt;% 
  mutate(cum_prop_returned_D2_beforenoon = round(cum_prop_returned_D2_morning+beads_returned_Day2_beforenoon/beads_collected,2)) %&gt;%
  mutate(cum_prop_returned_D2_afternoon = round(cum_prop_returned_D2_beforenoon+beads_returned_Day2_afternoon/beads_collected,2)) %&gt;% 
  mutate(cum_prop_returned_D3_beforenoon = round(cum_prop_returned_D2_beforenoon+beads_returned_Day3_beforenoon/beads_collected,2)) %&gt;% 
  mutate(cum_prop_returned_D4_morning = round(cum_prop_returned_D3_beforenoon+beads_returned_Day4_morning/beads_collected,2)) %&gt;% 
  mutate(cum_prop_returned_D4_beforenoon = round(cum_prop_returned_D4_morning+beads_returned_Day4_beforenoon/beads_collected,2)) %&gt;% 
  
  mutate(beads_collected_group = ifelse(beads_collected &lt; 22, &quot;less_than_22&quot;, 
                                        ifelse(beads_collected &gt; 40, 
                                               &quot;greater_than_40&quot;, &quot;between_22_and_40&quot;))) %&gt;%
  arrange(age_2022, beads_collected_group) %&gt;% 
  
  select(colonyID,
         age_2022, age_class,
         beads_collected_group,
         bead_color,
         cum_prop_returned_D1_beforenoon:cum_prop_returned_D4_beforenoon,
         everything())</code></pre>
<pre class="r"><code>tidydat.2022 %&lt;&gt;% 
  
  ## keep only colonies that collected at least 40 (of 50) beads offered
  filter(beads_collected_group == &quot;greater_than_40&quot;) %&gt;% 
  
  pivot_longer(cols = starts_with(&quot;cum_prop&quot;),
               names_to = &quot;counted_when&quot;,
               values_to = &quot;cum_prop&quot;) %&gt;% 
  
  ## format the ordinal columns correctly
  mutate(counted_when = ifelse(counted_when == &quot;cum_prop_returned_D1_beforenoon&quot;, &quot;D1_bN&quot;,
                            ifelse(counted_when == &quot;cum_prop_returned_D1_afternoon&quot;, &quot;D1_aN&quot;,
                                   ifelse(counted_when == &quot;cum_prop_returned_D2_morning&quot;, &quot;D2_M&quot;,
                                          ifelse(counted_when == &quot;cum_prop_returned_D2_beforenoon&quot;, &quot;D2_bN&quot;,
                                            ifelse(counted_when == &quot;cum_prop_returned_D2_afternoon&quot;, &quot;D2_aN&quot;,
                                            ifelse(counted_when == &quot;cum_prop_returned_D3_beforenoon&quot;, &quot;D3_bN&quot;,
                                            ifelse(counted_when == &quot;cum_prop_returned_D4_morning&quot;, &quot;D4_M&quot;,
                                                 &quot;D4_bN&quot;)))))))) %&gt;%
  mutate(counted_when = factor(counted_when, 
                               levels = c(&quot;D1_bN&quot;, &quot;D1_aN&quot;, 
                                          &quot;D2_M&quot;, &quot;D2_bN&quot;, &quot;D2_aN&quot;,
                                          &quot;D3_bN&quot;,
                                          &quot;D4_M&quot;, &quot;D4_bN&quot;))) %&gt;% 
  mutate(bead_color = factor(ifelse(bead_color %in% c(&quot;light_blue&quot;, &quot;dark_blue&quot;), &quot;blue&quot;, bead_color),
                             levels = c(&quot;pink&quot;,&quot;green&quot;,&quot;blue&quot;)))  %&gt;% 
  mutate(colonyID = factor(colonyID)) %&gt;% 
  mutate(date = as.Date(date, format=&quot;%m/%d/%y&quot;)) %&gt;% 
  
  mutate(age_obs = age_2022) %&gt;% 
  
  # ## remove the timepoints that we do not have data for  
  # pink beads (round one)
  filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D1_aN&quot;)) %&gt;%
  filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D2_aN&quot;)) %&gt;%
  filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D4_M&quot;)) %&gt;%
  filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D4_bN&quot;)) %&gt;%
  # green beads (round two)
  filter(!(bead_color==&quot;green&quot; &amp; counted_when == &quot;D2_aN&quot;)) %&gt;%
  filter(!(bead_color==&quot;green&quot; &amp; counted_when == &quot;D3_bN&quot;)) %&gt;%
  filter(!(bead_color==&quot;green&quot; &amp; counted_when == &quot;D4_M&quot;)) %&gt;%
  # blue beads (round three)
  filter(!(bead_color==&quot;blue&quot; &amp; counted_when == &quot;D1_aN&quot;)) %&gt;%
  filter(!(bead_color==&quot;blue&quot; &amp; counted_when == &quot;D2_bN&quot;)) %&gt;%
  filter(!(bead_color==&quot;blue&quot; &amp; counted_when == &quot;D4_bN&quot;)) %&gt;% 
  
  ## select columns to make them compatible with 2021 dataset
  select(colonyID, date,
         bead_color,
         age_2022, age_obs, age_class, 
         beads_collected, counted_when, cum_prop)</code></pre>
<div id="combine-the-2021-and-2022-datasets" class="section level3">
<h3>Combine the 2021 and 2022 datasets</h3>
<blockquote>
<p>Currently showing all the data from 2021 and 2022.</p>
</blockquote>
<pre class="r"><code>## Combine the two data sets
tidydat &lt;- rbind(old.summ, tidydat.2022) %&gt;%
  mutate(counted_when = factor(counted_when,
                               levels = c(&quot;D1_bN&quot;, &quot;D1_aN&quot;,
                                          &quot;D2_M&quot;, &quot;D2_bN&quot;, &quot;D2_aN&quot;,
                                          &quot;D3_bN&quot;,
                                          &quot;D4_M&quot;, &quot;D4_bN&quot;))) %&gt;% 
  mutate(age_class = ifelse(age_obs &lt;= 2, &quot;1-2_yr&quot;,
                            ifelse(age_obs &gt; 2 &amp; age_obs &lt;= 4, &quot;3-4_yr&quot;,
                                   ifelse(age_obs &gt;=5 &amp; age_obs &lt; 10, &quot;5-9_yr&quot;,
                                                 &quot;10+_yr&quot;)))) %&gt;% 
  mutate(age_class = factor(age_class, 
                            levels = c(&quot;1-2_yr&quot;, &quot;3-4_yr&quot;,
                                       &quot;5-9_yr&quot;, &quot;10+_yr&quot;)))

# # use only 2022 data
# tidydat &lt;- tidydat.2022

which.colonies &lt;- tidydat %&gt;% select(colonyID, age_obs, age_class) %&gt;% distinct()

tidydat &lt;- tidydat %&gt;% 
  mutate(colonyID = factor(colonyID, levels = which.colonies %&gt;% arrange(age_obs) %&gt;% pull(1) %&gt;% unique()))</code></pre>
</div>
</div>
<div id="cumulative-bead-returned" class="section level2">
<h2>Cumulative bead returned</h2>
<pre class="r"><code># tidydat %&gt;% 
#   
#   na.omit() %&gt;% 
#   
#   ggplot(aes(x=counted_when, y=cum_prop, fill=age_class, color=age_class, group=age_class)) +
#   geom_jitter(size=2, alpha=0.4, width=0.2) +
#   # geom_line(aes(group=colonyID), size=0.5, alpha=0.7) +
#   # geom_boxplot(alpha=0.3) +
#   geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), 
#               level=0.95,
#               alpha=0.4, size = 2,
#               aes(color=age_class)) +
#   # geom_smooth(method = &quot;lm&quot;, formula = y~x, alpha=0.3, aes(color=age_class, lty=age_class)) +
#   
#   facet_wrap(~bead_color, nrow = 1) +
#   # coord_flip() +
#   # scale_y_continuous(n.breaks = 3,
#   #                    labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
#   
#   theme_Publication(base_size = 15) +
#   # rotate x-axis lables
#   theme(axis.text.x=element_text(angle=90,hjust=1))+
#   # scale_fill_discrete() +
#   # scale_color_discrete()
# 
#   # scale_fill_viridis_d(option=&quot;cividis&quot;) +
#   # scale_color_viridis_d(option = &quot;cividis&quot;)
#   
#   scale_fill_manual(values = age_colors) +
#   scale_color_manual(values = age_colors) +
#   
#   labs(x = &quot;Day-time of observation&quot;,
#        y= &quot;cumulative proportion \nof beads returned&quot;,
#        subtitle = &quot;Line indicates y ~ log2(x+1) + 95% CI&quot;,
#        caption = &quot;Note 
#        there were flash floods on Day 2 evening
#        (Tuesday; we missed Wednesday&#39;s field work)
#        of the second experimental run (green beads),
#        which was three days prior to the start of the third round (blue beads).&quot;)


## All colonies - 1

tidydat %&gt;% 
  
  na.omit() %&gt;% 
  
  # ## remove the timepoints that we do not have data for  
  # filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D1_aN&quot;)) %&gt;%
  # filter(!(bead_color==&quot;green&quot; &amp; counted_when == &quot;D3_bN&quot;)) %&gt;%
  
  ggplot(aes(x=counted_when, y=cum_prop, fill=age_class, color=age_class, group=age_class)) +
  geom_jitter(size=2, alpha=0.4, width = 0.2) +
  
  # geom_smooth(method = &quot;gam&quot;, aes(group=age_class), formula = y~s(x, bs=&quot;cs&quot;, k=3), alpha=0.4, size = 2) +
  geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), alpha=0.4, size = 2, aes(color=age_class)) +
  
  # facet_grid(~age_class) +
  # coord_flip() +
  scale_y_continuous(n.breaks = 3,
                     labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
  
  theme_Publication(base_size = 15) +
  # rotate x-axis lables
  theme(axis.text.x=element_text(angle=90,hjust=1))+
  
  scale_fill_manual(values = age_colors) +
  scale_color_manual(values = age_colors) +
  
  labs(x = &quot;Day-time of observation&quot;,
       y= &quot;cumulative proportion \nof beads returned&quot;,
       subtitle = &quot;Line indicates y ~ log2(x+1) + 95% CI&quot;,
       caption = &quot;Note
       data shown for all three rounds of bead experiment&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/plot_boxplot-1.png" width="672" /></p>
<pre class="r"><code>## All colonies - 2

tidydat[!is.infinite(rowSums(tidydat %&gt;% select(cum_prop))),] %&gt;% 
  
  # ## remove the timepoints that we do not have data for  
  # filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D1_aN&quot;)) %&gt;%
  # filter(!(bead_color==&quot;green&quot; &amp; counted_when == &quot;D3_bN&quot;)) %&gt;%
  
  ggplot(aes(x=counted_when, y=cum_prop, fill=age_class, color=age_class, group=age_class)) +
  geom_jitter(size=2, alpha=0.5, width = 0.2) +
  geom_line(aes(group=bead_color), size=2, alpha=0.7) +
  # geom_boxplot(alpha=0.6, aes(group=counted_when)) +
  # geom_violin(alpha=0.3) +
  # geom_smooth(method = &quot;gam&quot;, formula=y~s(x, k=5)) +
  
  # geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), 
  #             alpha=0.5, size = 2, 
  #             aes(color=age_class)) +
  
  facet_wrap(colonyID~bead_color, nrow=6) +
  # coord_flip() +
  # scale_y_continuous(n.breaks = 3,labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
  
  # theme_Publication(base_size = 10) +
  theme_bw(base_size = 8) +
  # rotate x-axis lables
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank())+
  
  scale_fill_manual(values = age_colors) +
  scale_color_manual(values = age_colors) +
  
  labs(x = &quot;Day-time of observation&quot;,
       y= &quot;cumulative proportion \nof beads returned&quot;,
       subtitle = &quot;&quot;,
       caption = &quot;not normalized for foraging activity&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/plot_boxplot-2.png" width="672" /></p>
<div id="potential-trash-accumulated-in-colony" class="section level3">
<h3>Potential trash accumulated in colony</h3>
<blockquote>
<p>The daily trash accumulated in the colony is proportional to the number of incoming foragers on a given day.</p>
</blockquote>
</div>
</div>
<div id="normalized-rate-of-trash-removal" class="section level2">
<h2>Normalized rate of trash removal</h2>
<blockquote>
<p>cumulative number of beads returned / possible number of incoming foragers on Day 1</p>
</blockquote>
<p>I am using the total number of foragers going in and out of the colony, for 30 secs, on Day 1 as a proxy for the possible number of incoming foragers.</p>
<pre class="r"><code># set path to your working directory (change, if necessary)
path_to_repo2 = &quot;/Users/biplabendudas/Documents/05_postdoc/Deborah_Gordon/04_research/2022/01_field_season_2022/04_field_work/02_rprojects/01_checking_data&quot;

# set path to the behavioral data within your repository 
path_to_data2 = &quot;/01_data/&quot;

## Specify the name of the master file as saved on your computer
filename2 &lt;- &quot;arizona_2022_master_list_Aug29_1440h.csv&quot;

column.names &lt;- c(&quot;date&quot;,
                  &quot;was_it_raining&quot;,
                  &quot;observer&quot;,
                  &quot;colony_ID&quot;,
                  &quot;first_obs&quot;,
                  &quot;second_obs&quot;,
                  &quot;time&quot;,
                  &quot;in_1&quot;,
                  &quot;out_1&quot;,
                  &quot;in_2&quot;,
                  &quot;out_2&quot;,
                  &quot;in_3&quot;,
                  &quot;out_3&quot;,
                  &quot;in_4&quot;,
                  &quot;out_4&quot;,
                  &quot;in_5&quot;,
                  &quot;out_5&quot;,
                  &quot;in_6&quot;,
                  &quot;out_6&quot;,
                  &quot;in_7&quot;,
                  &quot;out_7&quot;,
                  &quot;in_8&quot;,
                  &quot;out_8&quot;
                  )

for.dat &lt;- 
  read.table(paste0(path_to_repo2, path_to_data2, filename2),
                  sep = &quot;,&quot;,
                  header = T,
                  na.strings = c(&quot;&quot;,&quot; &quot;),
                  stringsAsFactors = F,
                  skip = 1) %&gt;% 
  as_tibble() %&gt;% 
  mutate(date = as.POSIXct(date, format=&quot;%m/%d/%Y&quot;, tz=&quot;MST&quot;)) %&gt;% 
  select(1:length(column.names))

colnames(for.dat) &lt;- column.names

tidy.for.2022 &lt;-
  for.dat %&gt;% 
  # remove columns containing first and second obs
  select(-first_obs, -second_obs, -was_it_raining) %&gt;% 
  
  
  group_by(date,observer,colony_ID,time) %&gt;% 
  mutate(tot_in = sum(in_1,in_2,in_3,in_4,in_5,in_6,in_7,in_8, na.rm = T),
         tot_out = sum(out_1,out_2,out_3,out_4,out_5,out_6,out_7,out_8, na.rm=T)) %&gt;% 
  mutate(foraging_30s = tot_in+tot_out) %&gt;% 
  ungroup() %&gt;% 
  
  mutate(colony_ID = as.factor(colony_ID),
         observer = as.factor(observer)) %&gt;% 
  
  # na.omit() %&gt;% 
  
  pivot_longer(.,
               cols = in_1:out_8,
               names_to = &quot;inout&quot;,
               values_to = &quot;n_ants&quot;) %&gt;% 
  
  group_by(inout) %&gt;% 
  mutate(inout2 = str_split_fixed(inout, &quot;_&quot;, 2)[1]) %&gt;%
  ungroup() %&gt;% 
  
  select(date:time, inout, 
         inout2,
         n_ants, tot_in, tot_out, everything())

all.dates &lt;- tidy.for.2022 %&gt;% pull(date) %&gt;% na.omit() %&gt;% unique()
date.max &lt;- tidy.for.2022 %&gt;% pull(date) %&gt;% na.omit() %&gt;% max()</code></pre>
<p>The task is to obtain the foraging (in and out) data for each of the bead colonies, for the duration of the different experimental rounds.</p>
<blockquote>
<p>pink: 8/16/2022; green: 8/22/22; blue: 8/26/22</p>
</blockquote>
<pre class="r"><code>which.dates &lt;- c(seq(as.Date(&quot;8/16/22&quot;, format=&quot;%m/%d/%y&quot;), 
                    as.Date(&quot;8/19/22&quot;, format=&quot;%m/%d/%y&quot;), by=1),
                 seq(as.Date(&quot;8/22/22&quot;, format=&quot;%m/%d/%y&quot;), 
                     as.Date(&quot;8/25/22&quot;, format=&quot;%m/%d/%y&quot;), by=1),
                 seq(as.Date(&quot;8/26/22&quot;, format=&quot;%m/%d/%y&quot;), 
                     as.Date(&quot;8/29/22&quot;, format=&quot;%m/%d/%y&quot;), by=1))
bead.dates &lt;- data.frame(date = which.dates,
                         obs_day = factor(rep(c(&quot;D1&quot;, &quot;D2&quot;, &quot;D3&quot;, &quot;D4&quot;), 3),
                                          levels = c(&quot;D1&quot;, &quot;D2&quot;, &quot;D3&quot;, &quot;D4&quot;)),
                         bead_color = factor(rep(c(&quot;pink&quot;, &quot;green&quot;, &quot;blue&quot;), each=4),
                                             levels = c(&quot;pink&quot;, &quot;green&quot;, &quot;blue&quot;))
                                             )
bead.colonies &lt;- tidydat %&gt;% pull(colonyID) %&gt;% unique() %&gt;% as.character()
which.day.obs &lt;- bead.dates %&gt;% mutate(date_obs = paste0(date, obs_day)) %&gt;% pull(date_obs)

tidy.for &lt;-
  tidy.for.2022 %&gt;% 
  
  mutate(date = as.character(date)) %&gt;% 
  filter(date %in% unique(as.character(bead.dates$date))) %&gt;% 
  mutate(date = as.Date(date)) %&gt;%
  
  filter(colony_ID %in% bead.colonies) %&gt;% 
  
  left_join(bead.dates, by=c(&quot;date&quot;)) %&gt;% 

  select(date, bead_color, colony_ID, obs_day, time, tot_in, tot_out, foraging_30s) %&gt;% 
  distinct() %&gt;% 
  arrange(bead_color, colony_ID, date) %&gt;% 
  ungroup()

tidy.for &lt;-
  tidy.for %&gt;%
  # calculate maximum foraging for each colony 
  group_by(colony_ID) %&gt;% 
    summarise(max_foraging_30s = max(foraging_30s)) %&gt;% 
    ungroup() %&gt;% 
    right_join(tidy.for) %&gt;% 
    mutate(prop_foraging_30s = foraging_30s/max_foraging_30s) %&gt;% 
    mutate_if(is.numeric, round, 2)
    
  

s.tidydat.2022 &lt;-
  tidydat.2022 %&gt;% 
  mutate(date = as.Date(date, format = &quot;%m/%d/%y&quot;)) %&gt;% 
  full_join(tidy.for %&gt;% select(-time) %&gt;% select(colonyID=colony_ID, everything()) %&gt;% filter(obs_day == &quot;D1&quot;), 
            by = c(&quot;date&quot;,&quot;bead_color&quot;,&quot;colonyID&quot;)) %&gt;% 
  na.omit() %&gt;% 
  mutate(s_cum_prop = round(cum_prop/foraging_30s, 2)) %&gt;% 
  mutate(s2_cum_prop = round(cum_prop/prop_foraging_30s, 2)) %&gt;% 
  na.omit() %&gt;% 
  # filter(s_cum_prop &lt;= 1) %&gt;% 
  select(colonyID:bead_color,
         age_2022:age_class, 
         beads_collected,
         foraging_30s,
         prop_foraging_30s,
         counted_when, cum_prop, 
         s_cum_prop, s2_cum_prop)


## Load the foraging data for 2021 dataset
filename3 &lt;- &quot;/Users/biplabendudas/Documents/05_postdoc/Deborah_Gordon/04_research/2022/02_bead_data/data/foraging_data.csv&quot;

tidy.for.2021 &lt;-
  read.csv(filename3) %&gt;% as_tibble() %&gt;%
    mutate(date = as.Date(date, format=&quot;%m/%d/%y&quot;)) %&gt;%
    mutate(colonyID = as.factor(colonyID)) 
  
tidy.for.2021 &lt;- 
  tidy.for.2021 %&gt;% 
  ## identify max foragers for each colony
  group_by(colonyID) %&gt;% 
  summarise(max_foraging_30s = max(foraging_30s)) %&gt;% 
  ungroup() %&gt;% 
  right_join(tidy.for.2021) %&gt;% 
  mutate(prop_foraging_30s = foraging_30s/max_foraging_30s) %&gt;% 
  mutate_if(is.numeric, round, 2)

s.tidydat.2021 &lt;- 
  old.summ %&gt;%
  mutate(colonyID = as.factor(colonyID)) %&gt;% 
  mutate(obs_day = parse_number(as.character(counted_when))) %&gt;% 
  filter(obs_day==1) %&gt;% 
  left_join(tidy.for.2021, by=c(&quot;colonyID&quot;, &quot;date&quot;)) %&gt;% 
  select(colonyID:bead_color, obs_day, foraging_30s, prop_foraging_30s) %&gt;% 
  
  mutate(colonyID = as.double(colonyID)) %&gt;%
  right_join(old.summ, by=c(&quot;colonyID&quot;, &quot;date&quot;, &quot;bead_color&quot;)) %&gt;% 
  
  group_by(colonyID,bead_color) %&gt;%  
  mutate(foraging_30s = foraging_30s[1]) %&gt;% 
  mutate(prop_foraging_30s = prop_foraging_30s[1]) %&gt;% 
  mutate(obs_day = paste0(&quot;D&quot;,obs_day[1])) %&gt;% 
  ungroup() %&gt;% 
  
  mutate(s_cum_prop = round(cum_prop/foraging_30s, 2)) %&gt;%
  mutate(s2_cum_prop = round(cum_prop/prop_foraging_30s, 2)) %&gt;%
  
  na.omit() %&gt;% 
  # filter(s_cum_prop &lt;= 1) %&gt;%
  
  select(colonyID:bead_color,
         age_2022:age_class, 
         beads_collected,
         foraging_30s,
         prop_foraging_30s,
         counted_when, cum_prop, 
         s_cum_prop, s2_cum_prop)


## combine the two files
s.tidydat &lt;- 
  rbind(s.tidydat.2021, s.tidydat.2022) %&gt;% 
    mutate(counted_when = factor(counted_when,
                               levels = c(&quot;D1_bN&quot;, &quot;D1_aN&quot;,
                                          &quot;D2_M&quot;, &quot;D2_bN&quot;, &quot;D2_aN&quot;,
                                          &quot;D3_bN&quot;,
                                          &quot;D4_M&quot;, &quot;D4_bN&quot;))) %&gt;% 
  mutate(age_class = ifelse(age_obs &lt;= 2, &quot;1-2_yr&quot;,
                            ifelse(age_obs &gt; 2 &amp; age_obs &lt;= 4, &quot;3-4_yr&quot;,
                                   ifelse(age_obs &gt;=5 &amp; age_obs &lt; 10, &quot;5-9_yr&quot;,
                                                 &quot;10+_yr&quot;)))) %&gt;% 
  mutate(age_class = factor(age_class, 
                            levels = c(&quot;1-2_yr&quot;, &quot;3-4_yr&quot;,
                                       &quot;5-9_yr&quot;, &quot;10+_yr&quot;)))

## order the colony IDs according to age
s.tidydat &lt;- s.tidydat %&gt;% 
  mutate(colonyID = factor(colonyID, levels = which.colonies %&gt;% arrange(age_obs) %&gt;% pull(1) %&gt;% unique()))

## NEED TO BE FIXED ##
## ISSUE 1
# There are multiple foraging data entries for colony 1536, that needs to be corrected
# For now, let&#39;s look at all colonies, except 1536
s.tidydat &lt;- s.tidydat %&gt;% filter(colonyID != &quot;1536&quot;)
## ISSUE 2
# There are two colonies for which we have collected more than 100% of the beads collected
# For now, let&#39;s remove those colonies
s.tidydat &lt;- s.tidydat %&gt;% filter(!(colonyID == &quot;1533&quot; &amp; bead_color == &quot;green&quot;)) %&gt;% filter(!(colonyID == &quot;1440&quot; &amp; bead_color == &quot;blue&quot;))
## ISSUE 3
# There are colonies that have no foraging data (or the colony did not forage) on D1 of bead experiments, 
# causing Inf values in s_cum_prop and s2_cum_prop
# For now, let&#39;s remove those colony-experiment-days
s.tidydat &lt;- 
  s.tidydat %&gt;% 
  # filter(is.infinite(s_cum_prop) | is.infinite(s2_cum_prop)) %&gt;% 
  filter(!(colonyID == &quot;1570&quot; &amp; bead_color == &quot;blue&quot;)) %&gt;% 
  filter(!(colonyID == &quot;1536&quot; &amp; bead_color == &quot;blue&quot;))</code></pre>
<div id="compare-foraging-across-age-class" class="section level3">
<h3>Compare foraging across age-class</h3>
<pre class="r"><code>## Plot 1
s.tidydat %&gt;% 
  select(colonyID, bead_color, age_obs, age_class, foraging_30s) %&gt;% 
  distinct() %&gt;%
  
  # group_by(age_obs) %&gt;%
  # summarize(n_unique = length(unique(colonyID)))
  
  ggplot(aes(x=as.factor(age_obs), y=foraging_30s)) +
  
  geom_boxplot(alpha=0.7, outlier.color = NA) +
    
    geom_jitter(width = 0.1, size=3, alpha=0.6, 
                aes(fill=as.factor(colonyID)), 
                shape=21) +
  
    
    geom_smooth(method = &quot;gam&quot;, aes(group=1)) +
    
    # stat_summary(fun = mean, geom = &quot;point&quot;, col=&quot;black&quot;,
    #              size=10, alpha=0.8,
    #              position=position_nudge(x = 0.3, y = 0)) +
    # stat_summary(fun.data = mean_cl_boot,
    #              size=2, alpha = 0.8,
    #              geom = &quot;errorbar&quot;, width = 0.2, fun.args = list(conf.int = 0.95),
    #              position=position_nudge(x = 0.3, y = 0)) +

    theme_Publication(base_size = 13) +

    labs(title = &quot;Colony foraging across different age-groups&quot;,
       subtitle = &quot;observations made on Day1 of bead expmts.&quot;,
       y = &quot;activity \n(mean ± 95% CI)&quot;,
       x = &quot;age-groups&quot;) +
  
    # scale_color_discrete() +
    # scale_fill_discrete() +

    # theme(legend.position=&quot;none&quot;) +

    theme(plot.subtitle=element_text(hjust=0.5, size=10),
          legend.title = element_blank()) +
    theme(legend.position=&quot;bottom&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/plot_foraging_ageclass-1.png" width="672" /></p>
<pre class="r"><code>## Plot 2
tidy.for %&gt;% 
  select(date, colonyID=colony_ID, foraging_30s) %&gt;% 
  right_join(which.colonies, by=&quot;colonyID&quot;) %&gt;% 
  
  ggplot(aes(x=as.factor(age_obs), y=foraging_30s)) +
  
  geom_boxplot(alpha=0.7) +
    
    geom_jitter(width = 0.1, size=2, alpha=0.6, 
                aes(shape=as.factor(age_class), col=as.factor(age_class))) +
  
    
    stat_summary(fun.data = mean_cl_boot,
                 col=&quot;#F26C60&quot;,
                 size=2, alpha = 0.8,
                 geom = &quot;errorbar&quot;, width = 0.2, fun.args = list(conf.int = 0.95),
                 position=position_nudge(x = 0.4, y = 0)) +
  stat_summary(fun = mean, geom = &quot;line&quot;, 
               aes(group=1),
               col=&quot;#F26C60&quot;,
                 size=2, alpha=0.9,
                 position=position_nudge(x = 0.4, y = 0)) +
  # geom_smooth(method = &quot;gam&quot;, aes(group=1)) +
  geom_smooth(method = &quot;gam&quot;, aes(group=1)) +

    theme_Publication(base_size = 13) +

    labs(title = &quot;Colony foraging across different age-groups&quot;,
       subtitle = &quot;all observations made on bead colonies&quot;,
       y = &quot;activity \n(mean ± 95% CI)&quot;,
       x = &quot;age-groups&quot;) +
  
    # scale_color_discrete() +
    # scale_fill_discrete() +

    # theme(legend.position=&quot;none&quot;) +
    theme(plot.subtitle=element_text(hjust=0.5, size=10),
          legend.title = element_blank()) +
    theme(legend.position=&quot;bottom&quot;) +
  
    ## add text labels
    ggrepel::geom_label_repel(data = . %&gt;% 
                    mutate(label = ifelse(foraging_30s &gt; 100,
                                          colonyID, &quot;&quot;)) %&gt;% 
                    group_by(colonyID) %&gt;% 
                    mutate_at(vars(label), funs(replace(., duplicated(.), &quot;&quot;))),
                    force = 11,
                    aes(label = label), 
                    box.padding = 0.3,
                    show.legend = FALSE)</code></pre>
<p><img src="bead_data_2022_files/figure-html/plot_foraging_ageclass-2.png" width="672" /></p>
<pre class="r"><code>## Plot 3
tidy.for.2022 %&gt;% 
  mutate(colony_ID = as.numeric(as.character(colony_ID))) %&gt;% 
  right_join(colony.dat %&gt;% select(colony_ID = colonyID, age_2022)) %&gt;% 
  na.omit() %&gt;% 
  mutate(age_obs = age_2022) %&gt;% 
  mutate(age_class = ifelse(age_obs &lt;= 2, &quot;1-2_yr&quot;,
                            ifelse(age_obs &gt; 2 &amp; age_obs &lt;= 4, &quot;3-4_yr&quot;,
                                   ifelse(age_obs &gt;=5 &amp; age_obs &lt; 10, &quot;5-9_yr&quot;,
                                                 &quot;10+_yr&quot;)))) %&gt;% 
  mutate(age_class = factor(age_class, 
                            levels = c(&quot;1-2_yr&quot;, &quot;3-4_yr&quot;,
                                       &quot;5-9_yr&quot;, &quot;10+_yr&quot;))) %&gt;% 
  
  ## test labels
  # mutate(label = ifelse(foraging_30s &gt; 200,
  #                                         colony_ID, &quot;&quot;)) %&gt;% 
  #                   group_by(colony_ID) %&gt;%
  #                   mutate_at(vars(label), funs(replace(., duplicated(.), &quot;&quot;)))
  
  # mutate(foraging_30s = log2(foraging_30s+1)) %&gt;% 
  
  ggplot(aes(x=as.factor(age_obs), y=foraging_30s)) +
  geom_boxplot(alpha=0.4, fill=&quot;#C5E4BA&quot;) +
  geom_jitter(width = 0.2, size=1, alpha=0.2, 
                aes(shape=as.factor(age_class), col=as.factor(age_class))) +
  stat_summary(fun.data = mean_cl_boot,
                 col=&quot;#F26C60&quot;,
                 size=2, alpha = 0.8,
                 geom = &quot;errorbar&quot;, width = 0.2, fun.args = list(conf.int = 0.95),
                 position=position_nudge(x = 0.4, y = 0)) +
  stat_summary(fun = mean, geom = &quot;line&quot;, 
               aes(group=1),
               col=&quot;#F26C60&quot;,
                 size=2, alpha=0.9,
                 position=position_nudge(x = 0.4, y = 0)) +
  geom_smooth(method = &quot;gam&quot;, aes(group=1)) +
    theme_Publication(base_size = 13) +
    labs(title = &quot;Colony foraging across different age-groups&quot;,
       subtitle = &quot;all observations of colony foraging in 2022&quot;,
       y = &quot;activity \n(mean ± 95% CI)&quot;,
       x = &quot;age-groups&quot;,
       caption = &quot;red line indicates mean ± 95% CI; \nblue line shows a GAM fit; \nlabels indicate colonies with activity more than 150 ants/30 secs&quot;) +
    # ylim(c(0,200)) +
    theme(plot.subtitle=element_text(hjust=0.5, size=10),
          plot.caption = element_text(hjust=1, size=10),
          legend.title = element_blank()) +
    theme(legend.position=&quot;bottom&quot;) +
  
    ## add text labels
    ggrepel::geom_label_repel(data = . %&gt;% 
                    mutate(label = ifelse(foraging_30s &gt; 150,
                                          colony_ID, &quot;&quot;)) %&gt;% 
                    group_by(colony_ID) %&gt;% 
                    mutate_at(vars(label), funs(replace(., duplicated(.), &quot;&quot;))),
                    force = 1,
                    size=2.5,
                    aes(label = label), 
                    box.padding = 0.3,
                    show.legend = FALSE)</code></pre>
<p><img src="bead_data_2022_files/figure-html/plot_foraging_ageclass-3.png" width="672" /></p>
</div>
<div id="plot-normalized-bead-returns" class="section level3">
<h3>Plot normalized bead returns</h3>
<pre class="r"><code># s.tidydat[!is.infinite(rowSums(s.tidydat %&gt;% select(s_cum_prop, s2_cum_prop))),] %&gt;% 
#   
#   ggplot(aes(x=counted_when, y=s_cum_prop, fill=age_class, color=age_class, group=age_class)) +
#   geom_jitter(size=2, alpha=0.4, width=0.2) +
#   # geom_line(aes(group=colonyID), size=0.5, alpha=0.7) +
#   # geom_boxplot(alpha=0.3) +
#   geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), 
#               level=0.95,
#               alpha=0.4, size = 2,
#               aes(color=age_class)) +
#   # geom_smooth(method = &quot;lm&quot;, formula = y~x, alpha=0.3, aes(color=age_class, lty=age_class)) +
#   
#   facet_wrap(~bead_color, nrow = 1) +
#   # coord_flip() +
#   # scale_y_continuous(n.breaks = 3, labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
#   
#   theme_Publication(base_size = 15) +
#   # rotate x-axis lables
#   theme(axis.text.x=element_text(angle=90,hjust=1))+
#   # scale_fill_discrete() +
#   # scale_color_discrete()
# 
#   # scale_fill_viridis_d(option=&quot;cividis&quot;) +
#   # scale_color_viridis_d(option = &quot;cividis&quot;)
#   
#   scale_fill_manual(values = age_colors) +
#   scale_color_manual(values = age_colors) +
#   
#   labs(x = &quot;Day-time of observation&quot;,
#        y= &quot;cumulative proportion \nof beads returned&quot;,
#        subtitle = &quot;Line indicates y ~ log2(x+1) + 95% CI&quot;,
#        caption = &quot;Note 
#        there were flash floods on Day 2 evening
#        (Tuesday; we missed Wednesday&#39;s field work)
#        of the second experimental run (green beads),
#        which was three days prior to the start of the third round (blue beads).&quot;)


## All colonies - 1

s.tidydat %&gt;% 
  
  ggplot(aes(x=counted_when, y=s_cum_prop, fill=age_class, color=age_class, group=age_class)) +
  geom_jitter(size=2, alpha=0.4, width = 0.2) +
  
  geom_smooth(method = &quot;gam&quot;, aes(group=age_class), formula = y~s(x, bs=&quot;cs&quot;, k=3), alpha=0.4, size = 2) +
  # geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), alpha=0.4, size = 2, aes(color=age_class)) +
  
  theme_Publication(base_size = 15) +
  # rotate x-axis lables
  theme(axis.text.x=element_text(angle=90,hjust=1))+
  
  scale_fill_manual(values = age_colors) +
  scale_color_manual(values = age_colors) +
  
  labs(x = &quot;Day-time of observation&quot;,
       y= &quot;cumulative proportion \nof beads returned&quot;,
       subtitle = &quot;Line indicates y ~ log2(x+1) + 95% CI&quot;,
       caption = &quot;normalized by foraging activity on D1 of bead experiments&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/plot_normalized_bead_returns-1.png" width="672" /></p>
<pre class="r"><code>## All colonies - 2

s.tidydat[!is.infinite(rowSums(s.tidydat %&gt;% select(s_cum_prop, s2_cum_prop))),] %&gt;% 
  
  # ## remove the timepoints that we do not have data for  
  # filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D1_aN&quot;)) %&gt;%
  # filter(!(bead_color==&quot;green&quot; &amp; counted_when == &quot;D3_bN&quot;)) %&gt;%
  
  ggplot(aes(x=counted_when, y=s_cum_prop, fill=age_class, color=age_class, group=age_class)) +
  geom_jitter(size=2, alpha=0.5, width = 0.2) +
  geom_line(aes(group=bead_color), size=2, alpha=0.7) +
  # geom_boxplot(alpha=0.6, aes(group=counted_when)) +
  # geom_violin(alpha=0.3) +
  # geom_smooth(method = &quot;gam&quot;, formula=y~s(x, k=5)) +
  
  # geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), 
  #             alpha=0.5, size = 2, 
  #             aes(color=age_class)) +
  
  facet_wrap(colonyID~bead_color, nrow=6) +
  # coord_flip() +
  # scale_y_continuous(n.breaks = 3,labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
  
  # theme_Publication(base_size = 10) +
  theme_bw(base_size = 8) +
  # rotate x-axis lables
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank())+
  
  scale_fill_manual(values = age_colors) +
  scale_color_manual(values = age_colors) +
  
  labs(x = &quot;Day-time of observation&quot;,
       y= &quot;cumulative proportion \nof beads returned&quot;,
       subtitle = &quot;&quot;,
       caption = &quot;normalized by foraging activity on D1 of bead experiments&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/plot_normalized_bead_returns-2.png" width="672" /></p>
<pre class="r"><code># &gt; I am wondering how would it look if I plot the curves for each age.

# s.tidydat %&gt;% 
#   
#   # ## remove the timepoints that we do not have data for  
#   # filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D1_aN&quot;)) %&gt;%
#   # filter(!(bead_color==&quot;green&quot; &amp; counted_when == &quot;D3_bN&quot;)) %&gt;%
#   
#   ggplot(aes(x=counted_when, y=s_cum_prop, 
#              fill=as.factor(age_obs), color=as.factor(age_obs), group=as.factor(age_obs))) +
#   geom_jitter(size=2, alpha=0.4, width = 0.2) +
#   # geom_line(aes(group=colonyID), size=0.5, alpha=0.7) +
#   # geom_boxplot(alpha=0.3, aes(group=age_class)) +
#   # geom_violin(alpha=0.3) +
#   # geom_smooth(method = &quot;gam&quot;, formula=y~s(x, k=5)) +
#   geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), 
#               alpha=0.4, size = 2,
#               aes(color=as.factor(age_obs))) +
#   
#   facet_grid(~age_class) +
#   # coord_flip() +
#   # scale_y_continuous(n.breaks = 3, labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
#   
#   theme_Publication(base_size = 15) +
#   # rotate x-axis lables
#   theme(axis.text.x=element_text(angle=90,hjust=1))+
#   
#   scale_fill_viridis_d() +
#   scale_color_viridis_d() +
#   
#   labs(x = &quot;Day-time of observation&quot;,
#        y= &quot;cumulative proportion \nof beads returned&quot;,
#        subtitle = &quot;Line indicates y ~ log2(x+1) + 95% CI&quot;,
#        caption = &quot;Note
#        data shown for all three rounds of bead experiment&quot;)</code></pre>
<pre class="r"><code># &gt; What about colony variation withih each age-class

# s.tidydat %&gt;% 
#   
#   # ## remove the timepoints that we do not have data for  
#   # filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D1_aN&quot;)) %&gt;%
#   # filter(!(bead_color==&quot;green&quot; &amp; counted_when == &quot;D3_bN&quot;)) %&gt;%
#   
#   ggplot(aes(x=counted_when, y=s_cum_prop, 
#              fill=as.factor(colonyID), color=as.factor(colonyID), group=as.factor(colonyID))) +
#   geom_jitter(size=2, alpha=0.4, width = 0.2) +
#   # geom_line(aes(group=colonyID), size=0.5, alpha=0.7) +
#   # geom_boxplot(alpha=0.3, aes(group=age_class)) +
#   # geom_violin(alpha=0.3) +
#   # geom_smooth(method = &quot;gam&quot;, formula=y~s(x, k=5)) +
#   geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), 
#               alpha=0.4, size = 2,
#               aes(color=as.factor(colonyID))) +
#   
#   facet_grid(~age_class) +
#   # coord_flip() +
#   # scale_y_continuous(n.breaks = 3, labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
#   
#   theme_Publication(base_size = 15) +
#   # rotate x-axis lables
#   theme(axis.text.x=element_text(angle=90,hjust=1))+
#   
#   scale_fill_viridis_d() +
#   scale_color_viridis_d() +
#   
#   labs(x = &quot;Day-time of observation&quot;,
#        y= &quot;cumulative proportion \nof beads returned&quot;,
#        subtitle = &quot;Line indicates y ~ log2(x+1) + 95% CI&quot;,
#        caption = &quot;Note
#        data shown for all three rounds of bead experiment&quot;)</code></pre>
</div>
<div id="plot-normalized-bead-returns-v2" class="section level3">
<h3>Plot normalized bead returns v2</h3>
<blockquote>
<p>Standardizing by proportion of foragers outside on Day 1 of bead experiments</p>
</blockquote>
<p>The idea is to divide the cumulative proportion of beads returned by the proportion of foragers (among the max foragers that were observed for a given colony) out on Day 1 of the bead experiments</p>
<pre class="r"><code># s.tidydat[!is.infinite(rowSums(s.tidydat %&gt;% select(s_cum_prop, s2_cum_prop))),] %&gt;% 
#   
#   ggplot(aes(x=counted_when, y=s2_cum_prop, fill=age_class, color=age_class, group=age_class)) +
#   geom_jitter(size=2, alpha=0.4, width=0.2) +
#   # geom_line(aes(group=colonyID), size=0.5, alpha=0.7) +
#   # geom_boxplot(alpha=0.3) +
#   geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), 
#               level=0.95,
#               alpha=0.4, size = 2,
#               aes(color=age_class)) +
#   # geom_smooth(method = &quot;lm&quot;, formula = y~x, alpha=0.3, aes(color=age_class, lty=age_class)) +
#   
#   facet_wrap(~bead_color, nrow = 1) +
#   # coord_flip() +
#   # scale_y_continuous(n.breaks = 3, labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
#   
#   theme_Publication(base_size = 15) +
#   # rotate x-axis lables
#   theme(axis.text.x=element_text(angle=90,hjust=1))+
#   # scale_fill_discrete() +
#   # scale_color_discrete()
# 
#   # scale_fill_viridis_d(option=&quot;cividis&quot;) +
#   # scale_color_viridis_d(option = &quot;cividis&quot;)
#   
#   scale_fill_manual(values = age_colors) +
#   scale_color_manual(values = age_colors) +
#   
#   labs(x = &quot;Day-time of observation&quot;,
#        y= &quot;cumulative proportion \nof beads returned&quot;,
#        subtitle = &quot;Line indicates y ~ log2(x+1) + 95% CI&quot;,
#        caption = &quot;&quot;)


## All colonies - 1

s.tidydat[!is.infinite(rowSums(s.tidydat %&gt;% select(s_cum_prop, s2_cum_prop))),] %&gt;% 
  
  # ## remove the timepoints that we do not have data for  
  # filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D1_aN&quot;)) %&gt;%
  # filter(!(bead_color==&quot;green&quot; &amp; counted_when == &quot;D3_bN&quot;)) %&gt;%
  
  ggplot(aes(x=counted_when, y=s2_cum_prop, fill=age_class, color=age_class, group=age_class)) +
  geom_jitter(size=2, alpha=0.4, width = 0.2) +
  # geom_line(aes(group=colonyID), size=0.5, alpha=0.7) +
  # geom_boxplot(alpha=0.3, aes(group=age_class)) +
  # geom_violin(alpha=0.3) +
  geom_smooth(method = &quot;gam&quot;, aes(group=age_class)) +
  # geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), 
  #             alpha=0.4, size = 2,
  #             aes(color=age_class)) +
  
  # facet_grid(~age_class) +
  # coord_flip() +
  # scale_y_continuous(n.breaks = 3, labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
  
  theme_Publication(base_size = 15) +
  # rotate x-axis lables
  theme(axis.text.x=element_text(angle=90,hjust=1))+
  
  scale_fill_manual(values = age_colors) +
  scale_color_manual(values = age_colors) +
  
  labs(x = &quot;Day-time of observation&quot;,
       y= &quot;cumulative proportion \nof beads returned&quot;,
       subtitle = &quot;Line indicates y ~ log2(x+1) + 95% CI&quot;,
       caption = &quot;&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/standardizing_v2-1.png" width="672" /></p>
<pre class="r"><code>## All colonies - 2
s.tidydat[!is.infinite(rowSums(s.tidydat %&gt;% select(s_cum_prop, s2_cum_prop))),] %&gt;% 
  # ## remove the timepoints that we do not have data for  
  # filter(!(bead_color==&quot;pink&quot; &amp; counted_when == &quot;D1_aN&quot;)) %&gt;%
  # filter(!(bead_color==&quot;green&quot; &amp; counted_when == &quot;D3_bN&quot;)) %&gt;%
  ggplot(aes(x=counted_when, y=s2_cum_prop, fill=age_class, color=age_class, group=age_class)) +
  geom_jitter(size=2, alpha=0.2, width = 0.2) +
  geom_line(aes(group=bead_color), size=1, alpha=0.7) +
  # geom_boxplot(alpha=0.6, aes(group=counted_when)) +
  # geom_violin(alpha=0.3) +
  # geom_smooth(method = &quot;gam&quot;, formula=y~s(x, k=5)) +
  # geom_smooth(method = &quot;lm&quot;, formula = y~log2(x+1), 
  #             alpha=0.5, size = 2, 
  #             aes(color=age_class)) +
  facet_wrap(colonyID~bead_color, nrow=6) +
  # coord_flip() +
  # scale_y_continuous(n.breaks = 3,labels = c(&quot;&quot;,&quot;0.5&quot;, &quot;1&quot;)) +
  
  # theme_Publication(base_size = 8) +
  theme_bw(base_size = 8) +
  # remove x-axis labels and ticks
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank())+
  
  scale_fill_manual(values = age_colors) +
  scale_color_manual(values = age_colors) +
  
  labs(x = &quot;Day-time of observation&quot;,
       y= &quot;cumulative proportion \nof beads returned&quot;,
       subtitle = &quot;&quot;,
       caption = &quot;normalized by proportion of foragers out on D1 of bead experiments&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/standardizing_v2-2.png" width="672" /></p>
<hr />
</div>
</div>
<div id="prelim-analyses-i" class="section level2">
<h2>Prelim Analyses I</h2>
<pre class="r"><code>s.tidydat.mod &lt;- s.tidydat %&gt;% mutate(log_s_cum_prop = log2(s_cum_prop+1)) %&gt;% mutate(log_s2_cum_prop = log2(s2_cum_prop+1))


mod.full.1 &lt;- lme4::lmer(s_cum_prop ~ age_class + counted_when + (1|colonyID) + (1|bead_color) ,
                 data=s.tidydat.mod, REML=F)
mod.red.1 &lt;- lme4::lmer(s_cum_prop ~ counted_when + (1|colonyID) + (1|bead_color) ,
                 data=s.tidydat.mod, REML=F)
anova(mod.full.1, mod.red.1, test=&quot;Chisq&quot;)</code></pre>
<pre><code>## Data: s.tidydat.mod
## Models:
## mod.red.1: s_cum_prop ~ counted_when + (1 | colonyID) + (1 | bead_color)
## mod.full.1: s_cum_prop ~ age_class + counted_when + (1 | colonyID) + (1 | 
## mod.full.1:     bead_color)
##            Df     AIC     BIC logLik deviance  Chisq Chi Df Pr(&gt;Chisq)   
## mod.red.1  11 -1878.1 -1836.5 950.04  -1900.1                            
## mod.full.1 14 -1884.7 -1831.7 956.33  -1912.7 12.587      3    0.00562 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>## Let&#39;s look at the summary of the model
lmerTest::ranova(mod.full.1)</code></pre>
<pre><code>## ANOVA-like table for random-effects: Single term deletions
## 
## Model:
## s_cum_prop ~ age_class + counted_when + (1 | colonyID) + (1 | bead_color)
##                  npar logLik     AIC     LRT Df Pr(&gt;Chisq)    
## &lt;none&gt;             14 956.33 -1884.7                          
## (1 | colonyID)     13 880.06 -1734.1 152.553  1  &lt; 2.2e-16 ***
## (1 | bead_color)   13 939.72 -1853.4  33.225  1  8.209e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>## Calculate the p-values for the fixed effects
## Source: https://mspeekenbrink.github.io/sdam-r-companion/linear-mixed-effects-models.html
afex::mixed(s_cum_prop ~ age_class + counted_when + (1|colonyID) + (1|bead_color) ,
                 data=s.tidydat.mod, check_contrasts = T, test_intercept = F, method=&quot;KR&quot;)</code></pre>
<pre><code>## Mixed Model Anova Table (Type 3 tests, KR-method)
## 
## Model: s_cum_prop ~ age_class + counted_when + (1 | colonyID) + (1 | 
## Model:     bead_color)
## Data: s.tidydat.mod
##         Effect        df         F p.value
## 1    age_class  3, 28.31   4.57 **    .010
## 2 counted_when 7, 284.62 10.33 ***   &lt;.001
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;+&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="prelim-analyses-ii" class="section level2">
<h2>Prelim Analyses II</h2>
<pre class="r"><code>mod.full.2 &lt;- lme4::lmer(s2_cum_prop ~ age_class + counted_when + (1|colonyID) + (1|bead_color) ,
                 data=s.tidydat.mod, REML=F)
mod.red.2 &lt;- lme4::lmer(s2_cum_prop ~ counted_when + (1|colonyID) + (1|bead_color) ,
                 data=s.tidydat.mod, REML=F)
anova(mod.full.2, mod.red.2, test=&quot;Chisq&quot;)</code></pre>
<pre><code>## Data: s.tidydat.mod
## Models:
## mod.red.2: s2_cum_prop ~ counted_when + (1 | colonyID) + (1 | bead_color)
## mod.full.2: s2_cum_prop ~ age_class + counted_when + (1 | colonyID) + (1 | 
## mod.full.2:     bead_color)
##            Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)
## mod.red.2  11 790.29 831.92 -384.15   768.29                         
## mod.full.2 14 794.20 847.18 -383.10   766.20 2.0932      3     0.5533</code></pre>
<pre class="r"><code>## Let&#39;s look at the summary of the model
lmerTest::ranova(mod.full.2)</code></pre>
<pre><code>## ANOVA-like table for random-effects: Single term deletions
## 
## Model:
## s2_cum_prop ~ age_class + counted_when + (1 | colonyID) + (1 | bead_color)
##                  npar  logLik    AIC    LRT Df Pr(&gt;Chisq)    
## &lt;none&gt;             14 -383.10 794.20                         
## (1 | colonyID)     13 -421.09 868.18 75.979  1  &lt; 2.2e-16 ***
## (1 | bead_color)   13 -394.87 815.75 23.547  1  1.219e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>## Calculate the p-values for the fixed effects
## Source: https://mspeekenbrink.github.io/sdam-r-companion/linear-mixed-effects-models.html
afex::mixed(s2_cum_prop ~ age_class + counted_when + (1|colonyID) + (1|bead_color) ,
                 data=s.tidydat.mod, check_contrasts = T, test_intercept = F, method=&quot;KR&quot;)</code></pre>
<pre><code>## Mixed Model Anova Table (Type 3 tests, KR-method)
## 
## Model: s2_cum_prop ~ age_class + counted_when + (1 | colonyID) + (1 | 
## Model:     bead_color)
## Data: s.tidydat.mod
##         Effect        df        F p.value
## 1    age_class  3, 28.05     0.64    .597
## 2 counted_when 7, 284.19 7.95 ***   &lt;.001
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;+&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>## Compare the two full models
AIC(mod.full.1, mod.full.2)</code></pre>
<pre><code>##            df        AIC
## mod.full.1 14 -1884.6651
## mod.full.2 14   794.2015</code></pre>
<pre class="r"><code>BIC(mod.full.1, mod.full.2)</code></pre>
<pre><code>##            df        BIC
## mod.full.1 14 -1831.6916
## mod.full.2 14   847.1751</code></pre>
<pre class="r"><code>## Checking to see how the model predictions compare against observed values
x &lt;- predict(mod.full.1)
y &lt;- s.tidydat.mod %&gt;% pull(s_cum_prop)
xy &lt;- data.frame(x,y)
xy %&gt;% 
ggplot(aes(x=x, y=y)) +
  # scale_x_continuous(limits = c(0,6)) +
  # scale_y_continuous(limits = c(0,6)) +
  geom_abline(intercept = 0, slope = 1, size=2, col=&quot;red&quot;) +
  geom_point() +
  theme_Publication() +
  labs(x=&quot;s_cum_prop predicted from mod.full.1&quot;,
       y=&quot;observed s_cum_prop&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/prelim_analyses_v2-1.png" width="672" /></p>
<pre class="r"><code># The slope should be 1
lm(x~y) %&gt;% summary()</code></pre>
<pre><code>## 
## Call:
## lm(formula = x ~ y)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -0.0244711 -0.0050128  0.0001236  0.0041253  0.0251014 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.0072776  0.0007032   10.35   &lt;2e-16 ***
## y           0.6611423  0.0243347   27.17   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.008482 on 323 degrees of freedom
## Multiple R-squared:  0.6956, Adjusted R-squared:  0.6947 
## F-statistic: 738.1 on 1 and 323 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code># How do the residuals look?
residuals(mod.full.1) %&gt;% plot(main=&quot;Residuals for model mod.full.1&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/prelim_analyses_v2-2.png" width="672" /></p>
</div>
<div id="prelim-analyses-iii" class="section level2">
<h2>Prelim Analyses III</h2>
<blockquote>
<p>Using prop_foraging_30s as a fixed effect</p>
</blockquote>
<pre class="r"><code>mod.full.3 &lt;- lme4::lmer(cum_prop ~ age_class + counted_when + prop_foraging_30s + (1|colonyID) + (1|bead_color) ,
                 data=s.tidydat.mod, REML=F)
# mod.red.3a &lt;- lme4::lmer(s2_cum_prop ~ counted_when + prop_foraging_30s + (1|colonyID) + (1|bead_color) ,
#                  data=s.tidydat.mod, REML=F)
# mod.red.3b &lt;- lme4::lmer(s2_cum_prop ~ counted_when + age_class + (1|colonyID) + (1|bead_color) ,
#                  data=s.tidydat.mod, REML=F)
# # Do age-classes differ?
# anova(mod.full.3, mod.red.3a, test=&quot;Chisq&quot;)
# # Do prop_foraging_30s has a significant effect
# anova(mod.full.3, mod.red.3b, test=&quot;Chisq&quot;)


## Compare the two full models
AIC(mod.full.1, mod.full.3)</code></pre>
<pre><code>##            df        AIC
## mod.full.1 14 -1884.6651
## mod.full.3 15  -187.3788</code></pre>
<pre class="r"><code>BIC(mod.full.1, mod.full.3)</code></pre>
<pre><code>##            df        BIC
## mod.full.1 14 -1831.6916
## mod.full.3 15  -130.6214</code></pre>
<pre class="r"><code>## Checking to see how the model predictions compare against observed values
x &lt;- predict(mod.full.3)
y &lt;- s.tidydat.mod %&gt;% pull(cum_prop)
xy &lt;- data.frame(x,y)
xy %&gt;% 
ggplot(aes(x=x, y=y)) +
  # scale_x_continuous(limits = c(0,6)) +
  # scale_y_continuous(limits = c(0,6)) +
  geom_abline(intercept = 0, slope = 1, size=2, col=&quot;red&quot;) +
  geom_point() +
  theme_Publication() +
  labs(x=&quot;cum_prop predicted from mod.full.3&quot;,
       y=&quot;observed cum_prop&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/prelim_analyses_v3-1.png" width="672" /></p>
<pre class="r"><code># The slope should be 1
lm(x~y) %&gt;% summary()</code></pre>
<pre><code>## 
## Call:
## lm(formula = x ~ y)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.38351 -0.06897  0.02171  0.07697  0.32729 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.23107    0.01687   13.70   &lt;2e-16 ***
## y            0.63269    0.02483   25.48   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1147 on 323 degrees of freedom
## Multiple R-squared:  0.6679, Adjusted R-squared:  0.6668 
## F-statistic: 649.5 on 1 and 323 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code># How do the residuals look?
residuals(mod.full.3) %&gt;% plot(main=&quot;Residuals for model mod.full.3&quot;)</code></pre>
<p><img src="bead_data_2022_files/figure-html/prelim_analyses_v3-2.png" width="672" /></p>
</div>
<div id="other-analyses" class="section level2">
<h2>Other analyses</h2>
<div id="linear-model" class="section level3">
<h3>linear model</h3>
</div>
<div id="binomial-regression" class="section level3">
<h3>binomial regression</h3>
</div>
<div id="generalized-additive-mixed-model" class="section level3">
<h3>generalized additive mixed model</h3>
<blockquote>
<p>Run GAM instead of lme4::lmer()</p>
</blockquote>
<p><a href="https://fromthebottomoftheheap.net/2021/02/02/random-effects-in-gams/">read more here</a></p>
<pre class="r"><code>mod.gam.1 &lt;- mgcv::gam(s_cum_prop ~ age_class + counted_when + s(colonyID, bs=&quot;re&quot;) + s(bead_color, bs=&quot;re&quot;), 
                       data = s.tidydat.mod, method=&quot;REML&quot;)
mod.gam.1.1 &lt;- mgcv::gam(s_cum_prop ~ age_class + as.numeric(counted_when) + prop_foraging_30s + s(colonyID, bs=&quot;re&quot;) + s(bead_color, bs=&quot;re&quot;), 
                       data = s.tidydat.mod, method=&quot;REML&quot;)
mod.gam.1.2 &lt;- mgcv::gam(s_cum_prop ~ age_class + s(as.numeric(counted_when), bs=&quot;cr&quot;, k=4) + prop_foraging_30s + 
                           s(colonyID, bs=&quot;re&quot;) + s(bead_color, bs=&quot;re&quot;),
                         data = s.tidydat.mod, method=&quot;REML&quot;)
mod.gam.1.3 &lt;- mgcv::gam(s_cum_prop ~ s(age_obs, bs=&quot;cr&quot;) + s(as.numeric(counted_when), bs=&quot;cr&quot;, k=4) + prop_foraging_30s + 
                           s(colonyID, bs=&quot;re&quot;) + s(bead_color, bs=&quot;re&quot;),
                         data = s.tidydat.mod, method=&quot;REML&quot;)
mod.gam.1.4 &lt;- mgcv::gam(s_cum_prop ~ s(age_obs, bs=&quot;cr&quot;) + s(as.numeric(counted_when), bs=&quot;cr&quot;, k=4) + prop_foraging_30s,
                         data = s.tidydat.mod, method=&quot;REML&quot;)

AIC(mod.full.1, mod.full.3, 
    mod.gam.1, 
    mod.gam.1.1, mod.gam.1.2, 
    mod.gam.1.3, mod.gam.1.4)</code></pre>
<pre><code>##                   df        AIC
## mod.full.1  14.00000 -1884.6651
## mod.full.3  15.00000  -187.3788
## mod.gam.1   40.56152 -1946.8340
## mod.gam.1.1 37.02491 -2078.1549
## mod.gam.1.2 38.90315 -2099.2858
## mod.gam.1.3 40.15279 -2100.7829
## mod.gam.1.4 13.58521 -1807.7270</code></pre>
<pre class="r"><code>summary(mod.gam.1.2)</code></pre>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## s_cum_prop ~ age_class + s(as.numeric(counted_when), bs = &quot;cr&quot;, 
##     k = 4) + prop_foraging_30s + s(colonyID, bs = &quot;re&quot;) + s(bead_color, 
##     bs = &quot;re&quot;)
## 
## Parametric coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        0.055679   0.005610   9.925   &lt;2e-16 ***
## age_class3-4_yr   -0.014921   0.006611  -2.257   0.0248 *  
## age_class5-9_yr   -0.017797   0.009540  -1.866   0.0631 .  
## age_class10+_yr   -0.008969   0.006528  -1.374   0.1705    
## prop_foraging_30s -0.037356   0.002930 -12.752   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                                edf Ref.df     F  p-value    
## s(as.numeric(counted_when))  2.518   2.82 40.75  &lt; 2e-16 ***
## s(colonyID)                 26.323  28.00 19.48  &lt; 2e-16 ***
## s(bead_color)                3.371   4.00 43.78 1.74e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.783   Deviance explained = 80.7%
## -REML = -988.8  Scale est. = 8.1491e-05  n = 325</code></pre>
<pre class="r"><code>plot(mod.gam.1.2)</code></pre>
<p><img src="bead_data_2022_files/figure-html/unnamed-chunk-1-1.png" width="672" /><img src="bead_data_2022_files/figure-html/unnamed-chunk-1-2.png" width="672" /><img src="bead_data_2022_files/figure-html/unnamed-chunk-1-3.png" width="672" /></p>
<pre class="r"><code>## Let&#39;s check the model fit
s.tidydat.mod %&gt;% 
  
  # response variable: s_cum_prop
  mutate(pred_s_cum_prop = predict(mod.full.1)) %&gt;%
  # mutate(pred_s_cum_prop = predict(mod.gam.1.2)) %&gt;%
  group_by(age_class, counted_when) %&gt;%
  summarise(mean_pred = mean(pred_s_cum_prop),
            ci95 = 1.96*sd(pred_s_cum_prop)/sqrt(n())) %&gt;%
  right_join(s.tidydat.mod) %&gt;%
  ggplot(aes(x=counted_when, y=s_cum_prop)) +
  
  # # response variable: s2_cum_prop
  # mutate(pred_s2_cum_prop = predict(mod.full.2)) %&gt;%
  # # mutate(pred_s_cum_prop = predict(mod.gam.1.2)) %&gt;% 
  # group_by(age_class, counted_when) %&gt;% 
  # summarise(mean_pred = mean(pred_s2_cum_prop),
  #           ci95 = 1.96*sd(pred_s2_cum_prop)/sqrt(n())) %&gt;% 
  # right_join(s.tidydat.mod) %&gt;% 
  # ggplot(aes(x=counted_when, y=s2_cum_prop)) +

  # # response variable: cum_prop
  # mutate(pred_cum_prop = predict(mod.full.3)) %&gt;%
  # # mutate(pred_s_cum_prop = predict(mod.gam.1.2)) %&gt;% 
  # group_by(age_class, counted_when) %&gt;% 
  # summarise(mean_pred = mean(pred_cum_prop),
  #           ci95 = 1.96*sd(pred_cum_prop)/sqrt(n())) %&gt;% 
  # right_join(s.tidydat.mod) %&gt;% 
  # ggplot(aes(x=counted_when, y=cum_prop)) +
  
  
  # scale_x_continuous(limits = c(0,0.1)) +
  # scale_y_continuous(limits = c(0,0.1)) +
  
  geom_jitter(color=&quot;grey60&quot;, size=2, alpha=0.5, width = 0.2) +
  
  geom_line(aes(y=mean_pred, x=counted_when, color=age_class, group=age_class), alpha=1, size=3) +
  geom_line(aes(y=mean_pred-ci95, x=counted_when, color=age_class, group=age_class), lty=2, alpha=1, size=1.5) +
  geom_line(aes(y=mean_pred+ci95, x=counted_when, color=age_class, group=age_class), lty=2, alpha=1, size=1.5) +
  
  facet_wrap(age_class~., nrow=2) +
  
  theme_Publication(base_size = 20) +
  labs(x=&quot;time&quot;) +
  scale_color_manual(values = age_colors) +
  theme(axis.text.x = element_blank())</code></pre>
<p><img src="bead_data_2022_files/figure-html/unnamed-chunk-1-4.png" width="672" /></p>
<pre class="r"><code># ## What about a GAMM?
# mod.gam.2 &lt;- mgcv::gamm(s2_cum_prop ~ age_class + s(as.numeric(counted_when), bs=&quot;cr&quot;, k=5),
#                         random=list(colonyID=~1, bead_color=~1), data = s.tidydat.mod)
# plot(mod.gam.2$gam)</code></pre>
<hr />
</div>
</div>
<div id="extras" class="section level2">
<h2>Extras</h2>
<blockquote>
<p>How many colonies, and which colonies, do we have for each age-class?</p>
</blockquote>
<pre class="r"><code>s.tidydat %&gt;% 
  mutate(age_obs = factor(paste0(age_obs, &quot; yr&quot;), 
                          level=paste0(sort(unique(.$age_obs)), &quot; yr&quot;))) %&gt;%
  group_by(age_obs) %&gt;% 
  summarize(n_colonies = length(unique(colonyID)),
            which_colonies = paste(as.character(unique(colonyID)), collapse = &quot;, &quot;)) %&gt;% 
  
  kableExtra::kable(caption = &quot;Colonies used in bead experiments&quot;, align = &quot;c&quot;) %&gt;%
  kableExtra::kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F, position = &quot;center&quot;)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Colonies used in bead experiments
</caption>
<thead>
<tr>
<th style="text-align:center;">
age_obs
</th>
<th style="text-align:center;">
n_colonies
</th>
<th style="text-align:center;">
which_colonies
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
2 yr
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
1581, 1587, 1570, 1541, 1542, 1571, 1552, 1533
</td>
</tr>
<tr>
<td style="text-align:center;">
3 yr
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
1504, 1506, 1512, 1559, 1486, 1503, 1546
</td>
</tr>
<tr>
<td style="text-align:center;">
4 yr
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1452, 1450, 1440
</td>
</tr>
<tr>
<td style="text-align:center;">
6 yr
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1393
</td>
</tr>
<tr>
<td style="text-align:center;">
7 yr
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1338, 1368, 1393
</td>
</tr>
<tr>
<td style="text-align:center;">
8 yr
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1368
</td>
</tr>
<tr>
<td style="text-align:center;">
10 yr
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1288
</td>
</tr>
<tr>
<td style="text-align:center;">
11 yr
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1288, 1317
</td>
</tr>
<tr>
<td style="text-align:center;">
12 yr
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1233, 1242
</td>
</tr>
<tr>
<td style="text-align:center;">
17 yr
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1107
</td>
</tr>
<tr>
<td style="text-align:center;">
20 yr
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1131, 1017
</td>
</tr>
<tr>
<td style="text-align:center;">
21 yr
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
922, 961, 969, 1131
</td>
</tr>
<tr>
<td style="text-align:center;">
24 yr
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
810
</td>
</tr>
<tr>
<td style="text-align:center;">
25 yr
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
810
</td>
</tr>
</tbody>
</table>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
