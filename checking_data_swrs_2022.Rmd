
---
title: "Daily data check"
author:
- name: foraging count data for 2022 field work
  affiliation: In case of questions, please contact [Biplabendu Das](https://biplabendu.github.io/homepage/)
date: Last updated on `r format(Sys.time(), "%d %B, %Y")`
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    theme: united
    keep_md: no
    code_folding: hide
    includes:
      in_header: analytics.html
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)

set.seed(420)
rm(list = ls())

## For more inspiration on customizing the html output, refer to the following:
# https://bookdown.org/yihui/rmarkdown/html-document.html#table-of-contents

```

___

## Housekeeping

```{r housekeeping, include=FALSE}

# Load the libraries
pacman::p_load(tidyverse, conflicted, ggplot2, viridis, conflicted, WaveletComp)
pacman::p_load(patchwork)
pacman::p_load(lubridate)

# set conflict preference
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
conflict_prefer("union", "dplyr")
conflict_prefer("lag", "dplyr")

# set path to your working directory (change, if necessary)
path_to_repo = "/Users/biplabendudas/OneDrive - University of Central Florida/UCF de bekker/PostDoc/Labs/Gordon/04_research/2022/01_field_season_2022/04_field_work/02_rprojects/01_checking_data"

# set path to the behavioral data within your repository 
path_to_data = "/01_data/"


# set path to the results
path_to_results = "/Users/biplabendudas/Documents/GitHub/homepage/images/2022_deborah/"

# load functions
# customized theme for publication quality figures
source(paste0(path_to_repo,"/03_functions/theme_publication.R"))
source(paste0(path_to_repo,"/03_functions/plot_zscores.R"))

```


```{r user_input, include=F}

## This is where you want to specify your parameters of choice.

## Specify the name of the master file as saved on your computer
filename <- "arizona_2022_master_list_Aug13_2043h.csv"

column.names <- c("date",
                  "observer",
                  "colony_ID",
                  "first_obs",
                  "second_obs",
                  "time",
                  "in_1",
                  "out_1",
                  "in_2",
                  "out_2",
                  "in_3",
                  "out_3",
                  "in_4",
                  "out_4",
                  "in_5",
                  "out_5",
                  "in_6",
                  "out_6",
                  "in_7",
                  "out_7",
                  "in_8",
                  "out_8"
                  )

```

___

## 1. Read data and tidy

```{r tidy_data}

dat <- 
  read.table(paste0(path_to_repo, path_to_data, filename),
                  sep = ",",
                  header = T,
                  na.strings = c(""," "),
                  stringsAsFactors = F,
                  skip = 1) %>% 
  as_tibble() %>% 
  select(1:length(column.names))

colnames(dat) <- column.names

tidy.dat <-
  dat %>% 
  # remove columns containing first and second obs
  select(-first_obs, -second_obs) %>% 
  
  
  group_by(date,observer,colony_ID) %>% 
  mutate(tot_in = sum(in_1,in_2,in_3,in_4,in_5,in_6,in_7,in_8, na.rm = T),
         tot_out = sum(out_1,out_2,out_3,out_4,out_5,out_6,out_7,out_8, na.rm=T)) %>% 
  ungroup() %>% 
  
  mutate(colony_ID = as.factor(colony_ID),
         observer = as.factor(observer),
         date = as.POSIXct(date, format="%m/%d/%Y", tz="MST")) %>% 
  
  # na.omit() %>% 
  
  pivot_longer(.,
               cols = in_1:out_8,
               names_to = "inout",
               values_to = "n_ants") %>% 
  
  group_by(inout) %>% 
  mutate(inout2 = str_split_fixed(inout, "_", 2)[1]) %>%
  ungroup() %>% 
  
  select(date:time, inout, 
         inout2,
         n_ants, tot_in, tot_out, everything())

all.dates <- tidy.dat %>% pull(date) %>% na.omit() %>% unique()
date.max <- tidy.dat %>% pull(date) %>% na.omit() %>% max()
```

> Analyzing data from 8/13/2022 (Aug 13, 2022) until `r date.max`.

___

## 2. Visualize as boxplots

> Currently showing all data for: `r date.max`

```{r plot_boxplots, include=F}
observers <- tidy.dat %>% pull(observer) %>% unique() %>% na.omit() %>% as.character()

plot.x <- list()

for(i in 1:length(observers)) {
  
  f.name <- paste0(observers[[i]],"_boxplots.png")
  
  plot.x[[i]] <- 
    tidy.dat %>% 
    filter(date == date.max) %>% 
    
    filter(observer == observers[[i]]) %>% 
    
    ggplot(aes(x=colony_ID, y=n_ants)) +
    # ggplot(aes(x=colony_ID, y=n_ants, group=inout2)) +
      geom_boxplot(aes(fill=inout2), 
                   alpha=0.75, 
                   outlier.size = 3,
                   outlier.shape = 21,
                   outlier.color = "red",
                   position = position_dodge(width = 0.95)) +
      # facet_grid(~observer) +
      theme_Publication(base_size = 40) +
      scale_fill_Publication() +
      coord_flip() +
    labs(x=paste0(observers[[i]], "'s colony ID"))
  
  # png(paste0(path_to_results,
  #          f.name), 
  #     width = 30, height = 45, units = "cm", res = 300)
  # print(plot.x[[i]])
  # trash <- dev.off()
  
}

png(paste0(path_to_results,
           "00_combined_images/",
           "all_boxplots.png"), 
      width = 40, height = 160, units = "cm", res = 150)
multi.plot(plot.x, rows = 5, cols=2)
trash <- dev.off()

```



```{r embed_boxplots_all, echo=F, out.width="75%", fig.cap='', fig.align='center'}

knitr::include_graphics(paste0(path_to_results,
           "00_combined_images/",
           "all_boxplots.png"))
  
```


```{r embed_boxplots, echo=F, out.width="49%", out.height="10%", fig.cap='', fig.show="hold", fig.align='center'}

# files <- list.files(path_to_results, full.names = T)[-1]
# knitr::include_graphics(files)
  
```

___

## Supplementary

#### 1. Reproducibility

- All code used for this document is available on my [Github](https://github.com/biplabendu/homepage/blob/master/checking_data_swrs_2022.Rmd).
